<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Liquid Metal — FORMA</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #060608; overflow: hidden; width: 100vw; height: 100vh; }
  canvas { display: block; }
  .label {
    position: fixed; bottom: 24px; left: 24px;
    font-family: 'Courier New', monospace;
    font-size: 11px; letter-spacing: 0.15em;
    color: rgba(255,255,255,0.2);
    text-transform: uppercase;
    pointer-events: none;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div class="label">Liquid Metal · Move cursor</div>
<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;
const mouse = { x: 0, y: 0, px: 0, py: 0 };
let time = 0;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
  mouse.x = W / 2; mouse.y = H / 2;
  mouse.px = W / 2; mouse.py = H / 2;
}
resize();
window.addEventListener('resize', resize);
window.addEventListener('mousemove', e => { mouse.px = mouse.x; mouse.py = mouse.y; mouse.x = e.clientX; mouse.y = e.clientY; });
window.addEventListener('touchmove', e => { mouse.x = e.touches[0].clientX; mouse.y = e.touches[0].clientY; }, { passive: true });

// Metaball system
const BALLS = 12;
let balls = [];

function initBalls() {
  balls = Array.from({ length: BALLS }, (_, i) => ({
    x: W * 0.2 + Math.random() * W * 0.6,
    y: H * 0.2 + Math.random() * H * 0.6,
    vx: (Math.random() - 0.5) * 1.5,
    vy: (Math.random() - 0.5) * 1.5,
    r: 80 + Math.random() * 120,
    phase: Math.random() * Math.PI * 2,
  }));
}
initBalls();

// Offscreen for metaballs
const off = document.createElement('canvas');
const offCtx = off.getContext('2d');

function resizeOff() {
  off.width = Math.floor(W / 3);
  off.height = Math.floor(H / 3);
}
resizeOff();
window.addEventListener('resize', resizeOff);

function drawMetaballs() {
  const sw = Math.floor(W / 3);
  const sh = Math.floor(H / 3);
  off.width = sw; off.height = sh;

  const imgData = offCtx.createImageData(sw, sh);
  const data = imgData.data;

  for (let py = 0; py < sh; py++) {
    for (let px = 0; px < sw; px++) {
      let sum = 0;
      const wx = px * 3;
      const wy = py * 3;
      for (const b of balls) {
        const dx = wx - b.x;
        const dy = wy - b.y;
        const dist2 = dx * dx + dy * dy;
        sum += (b.r * b.r) / (dist2 + 1);
      }
      // Mouse ball
      const mdx = wx - mouse.x;
      const mdy = wy - mouse.y;
      const md2 = mdx * mdx + mdy * mdy;
      sum += 14000 / (md2 + 1);

      const idx = (py * sw + px) * 4;
      if (sum > 1.2) {
        const t = Math.min((sum - 1.2) / 2, 1);
        // Color: silver/chrome with subtle hue shift
        const hue = 200 + Math.sin(sum * 0.5 + time * 0.01) * 30;
        const l = 60 + t * 30;
        const r = l + Math.sin(hue * 0.02) * 20;
        const g = l + Math.cos(hue * 0.015) * 15;
        const bv = l + Math.sin(hue * 0.025 + 1) * 25;
        data[idx] = Math.min(255, r);
        data[idx + 1] = Math.min(255, g);
        data[idx + 2] = Math.min(255, bv);
        data[idx + 3] = Math.min(255, t * 255);
      } else if (sum > 0.5) {
        const t = (sum - 0.5) / 0.7;
        data[idx] = 30 + t * 20;
        data[idx + 1] = 30 + t * 25;
        data[idx + 2] = 50 + t * 40;
        data[idx + 3] = t * 80;
      }
    }
  }
  offCtx.putImageData(imgData, 0, 0);
}

function draw() {
  time++;
  ctx.fillStyle = 'rgba(6,6,8,0.3)';
  ctx.fillRect(0, 0, W, H);

  // Update balls
  balls.forEach((b, i) => {
    // Gentle float
    b.vx += Math.sin(time * 0.008 + b.phase) * 0.04;
    b.vy += Math.cos(time * 0.006 + b.phase) * 0.04;

    // Mouse attract
    const dx = mouse.x - b.x;
    const dy = mouse.y - b.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < 300) {
      b.vx += (dx / dist) * 0.08;
      b.vy += (dy / dist) * 0.08;
    }

    b.vx *= 0.96;
    b.vy *= 0.96;
    b.x += b.vx;
    b.y += b.vy;

    // Bounce
    if (b.x < 0 || b.x > W) b.vx *= -1;
    if (b.y < 0 || b.y > H) b.vy *= -1;
    b.x = Math.max(0, Math.min(W, b.x));
    b.y = Math.max(0, Math.min(H, b.y));
  });

  // Draw metaballs upscaled
  drawMetaballs();
  ctx.save();
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';
  ctx.drawImage(off, 0, 0, W, H);
  ctx.restore();

  // Overlay shimmer
  balls.forEach(b => {
    const grad = ctx.createRadialGradient(b.x, b.y, 0, b.x, b.y, b.r * 0.4);
    grad.addColorStop(0, `rgba(255,255,255,${0.04 + Math.sin(time * 0.02 + b.phase) * 0.02})`);
    grad.addColorStop(1, 'rgba(255,255,255,0)');
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.r * 0.4, 0, Math.PI * 2);
    ctx.fill();
  });

  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
