<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dark Smoke — FORMA</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #030305; overflow: hidden; width: 100vw; height: 100vh; }
  canvas { display: block; }
  .label {
    position: fixed; bottom: 24px; left: 24px;
    font-family: 'Courier New', monospace;
    font-size: 11px; letter-spacing: 0.15em;
    color: rgba(255,255,255,0.2);
    text-transform: uppercase;
    pointer-events: none;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div class="label">Dark Smoke · Click &amp; drag</div>
<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

const mouse = { x: 0, y: 0, px: 0, py: 0, down: false };
window.addEventListener('mousemove', e => {
  mouse.px = mouse.x; mouse.py = mouse.y;
  mouse.x = e.clientX; mouse.y = e.clientY;
});
window.addEventListener('mousedown', () => mouse.down = true);
window.addEventListener('mouseup', () => mouse.down = false);
window.addEventListener('touchmove', e => {
  mouse.px = mouse.x; mouse.py = mouse.y;
  mouse.x = e.touches[0].clientX; mouse.y = e.touches[0].clientY;
  mouse.down = true;
}, { passive: true });
window.addEventListener('touchend', () => mouse.down = false);

// Smoke particles
class SmokeParticle {
  constructor(x, y, vx, vy, fromMouse = false) {
    this.x = x; this.y = y;
    this.vx = vx + (Math.random() - 0.5) * 0.8;
    this.vy = vy - Math.random() * 1.5 - 0.5;
    this.life = 1;
    this.decay = 0.005 + Math.random() * 0.008;
    this.size = fromMouse ? 40 + Math.random() * 60 : 20 + Math.random() * 40;
    this.hue = fromMouse ? (Math.random() > 0.5 ? 260 : 200) : 240;
    this.saturation = fromMouse ? 40 + Math.random() * 40 : 10;
    this.rotation = Math.random() * Math.PI * 2;
    this.rotSpeed = (Math.random() - 0.5) * 0.02;
  }
  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.vx *= 0.99;
    this.vy *= 0.99;
    this.life -= this.decay;
    this.size += 0.5;
    this.rotation += this.rotSpeed;
  }
  draw(ctx) {
    ctx.save();
    ctx.globalAlpha = Math.max(0, this.life) * 0.15;
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation);
    const grad = ctx.createRadialGradient(0, 0, 0, 0, 0, this.size);
    grad.addColorStop(0, `hsla(${this.hue},${this.saturation}%,70%,1)`);
    grad.addColorStop(1, `hsla(${this.hue},${this.saturation}%,70%,0)`);
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(0, 0, this.size, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
  }
}

let particles = [];
let time = 0;

// Auto-emit sources
const sources = [
  { x: 0.2, y: 0.9 },
  { x: 0.5, y: 0.95 },
  { x: 0.8, y: 0.9 },
];

function draw() {
  time++;

  ctx.fillStyle = 'rgba(3,3,5,0.12)';
  ctx.fillRect(0, 0, W, H);

  // Auto emit
  if (time % 3 === 0) {
    sources.forEach(s => {
      const x = s.x * W + (Math.random() - 0.5) * 80;
      const y = s.y * H;
      particles.push(new SmokeParticle(x, y, (Math.random() - 0.5) * 0.5, 0, false));
    });
  }

  // Mouse emit
  if (mouse.down || Math.abs(mouse.x - mouse.px) > 2) {
    for (let i = 0; i < 3; i++) {
      const vx = (mouse.x - mouse.px) * 0.1;
      const vy = (mouse.y - mouse.py) * 0.1;
      particles.push(new SmokeParticle(mouse.x, mouse.y, vx, vy, true));
    }
  }

  // Always emit a tiny bit from cursor
  if (time % 2 === 0 && mouse.x > 0) {
    particles.push(new SmokeParticle(mouse.x, mouse.y, 0, 0, true));
  }

  // Update & draw
  particles = particles.filter(p => p.life > 0);
  particles.forEach(p => { p.update(); p.draw(ctx); });

  // Cap particles
  if (particles.length > 600) particles.splice(0, 10);

  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
